<!DOCTYPE html>
<html lang="en">
<head>
    <title>webproject</title>
    <script>
        function addZero(a){
            if(a<10){
                a=`0${a}`;
            }
            else{
                a=a.toString();
            }
            return a;
        }
        function setClock(){
            let newTime = new Date();
            let hour = newTime.getHours();
            let min = newTime.getMinutes();
            let sec = newTime.getSeconds();
            if(hour>12){
                hour-=12;
                document.getElementById("am").innerHTML="PM";
            }
            else if(hour==0){
                hour=12;
                document.getElementById("am").innerHTML="AM";
            }
            else{
                document.getElementById("am").innerHTML="AM";
            }
            document.getElementById("time").innerHTML=addZero(hour)+":"+addZero(min);
            document.getElementById("sec").innerHTML=addZero(sec);
        }
        function setDate(){
            let newDate = new Date();
            let year = newDate.getFullYear();
            let month = newDate.getMonth()+1;
            let date = newDate.getDate();
            let dayIndex = newDate.getDay();
            let day;
            if(dayIndex==0){
                day="일";
            }
            else if(dayIndex==1){
                day="월";
            }
            else if(dayIndex==2){
                day="화";
            }
            else if(dayIndex==3){
                day="수";
            }
            else if(dayIndex==4){
                day="목";
            }
            else if(dayIndex==5){
                day="금";
            }
            else if(dayIndex==6){
                day="토";
            }
            document.getElementById("date").innerHTML=year+"년 "+ month+"월 "+ date+"일 "+ day+"요일";
        }
        async function getWeather(lat, lng) {
        const data = [];
        try {
            const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=e89d6cbebe4567f9679d37643de972fd`);
            const weatherJson = await weatherResponse.json();

            const microResponse = await fetch(`http://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lng}&appid=e89d6cbebe4567f9679d37643de972fd`);
            const microJson = await microResponse.json();

            data.push(weatherJson);
            data.push(microJson);

            console.log(data);
        } catch (error) {
            console.error("날씨데이터 접근 중 error 발생", error.message);
        }
    }

    async function userLocation(position) {
        let userLat = position.coords.latitude;
        let userLng = position.coords.longitude;
        await getWeather(userLat, userLng);
    }

function errorMsg(error) {
    console.error("사용자 위치정보 차단");
}

    window.onload = function () {
        setClock();
        setDate();
        setInterval(setClock, 100);
        setInterval(setDate, 1000);
        navigator.geolocation.getCurrentPosition(userLocation, errorMsg);
    }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap');
        #container{
            width: 400px;
            height: 200px;
            position: relative;
            margin: 100px auto;
        }
        #time{
            position: absolute;
            width: 300px;
            height: 150px;
            font-size: 120px;
        }
        #am{
            position: absolute;
            width: 70px;
            height: 70px;
            left: 305px;
            top: 20px;
            font-size: 40px;
        }
        #sec{
            position: absolute;
            width: 70px;
            height: 70px;
            left: 305px;
            top: 80px;
            font-size: 40px;
        }
        #date{
            position: absolute;
            width: 230px;
            height: 25px;
            top: 125px;
            left: 85px;
            font-size: 20px;
        }
        #weather{
            width: 200px;
            height: 150px;
            position: relative;

        }
    </style>
</head>
<body style="font-family: 'roboto', sans-serif;">
    <div id="container">
        <div id="time"></div>
        <div id="am"></div>
        <div id="sec"></div>
        <div id="date"></div>
    </div>
    <div id="weather">
        <div id="icon"></div>
        <div id="temp"></div>
        <div id="loca"></div>
    </div>
</body>
</html>